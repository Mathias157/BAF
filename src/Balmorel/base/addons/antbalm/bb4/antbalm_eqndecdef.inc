* Reading transmission capacities
$if     EXIST '../data/ANTBALM_XMIN.inc' $INCLUDE         '../data/ANTBALM_XMIN.inc';
$if not EXIST '../data/ANTBALM_XMIN.inc' $INCLUDE '../../base/data/ANTBALM_XMIN.inc';

* Reading generation capacites
$if     EXIST '../data/ANTBALM_GMIN.inc' $INCLUDE         '../data/ANTBALM_GMIN.inc';
$if not EXIST '../data/ANTBALM_GMIN.inc' $INCLUDE '../../base/data/ANTBALM_GMIN.inc';


$ifi not %CAPCRED%==yes $goto NoCapCred
Equations
   QANTBALM_RESCAP(YYY, RRR)    'Minimum reserve capacity for system based on Antares results'
   QANTBALM_H2RESCAP(YYY, RRR)    'Minimum reserve capacity for system based on Antares results'
;

* Constraint currently not including transmission or storage
QANTBALM_RESCAP(IY411, IR)$(GINVESTSTART LE YVALUE(IY411))..
    SUM((IA,G)$(IAGK_HASORPOT(IY411,IA,G) AND RRRAAA(IR,IA) AND IGE(G) AND NOT(IGH(G)) AND NOT(IHYDROGEN_GH2STO(G)) AND NOT(IHYDROGEN_GETOHH2(G)) AND NOT(IHYDROGEN_GETOH2(G)) AND NOT(IHYDROGEN_GCH4TOH2(G))),
    GKFX(IY411,IA,G)*ANTBALM_GCAPCRED(IY411, IR,G)/(1$((NOT IGESTO(G)) AND (NOT IGESTOS(G)))+GDATA(G,'GDSTOHUNLD')$((IGESTO(G)) OR IGESTOS(G)))
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM(IY411,IA,G)$IGDECOMEXOPOT(IY411,IA,G)*ANTBALM_GCAPCRED(IY411, IR,G)/(1$((NOT IGESTO(G)) AND (NOT IGESTOS(G)))+GDATA(G,'GDSTOHUNLD')$((IGESTO(G)) OR IGESTOS(G)))
    )
    +SUM(IAGK_HASORPOT(IY411,IA,G)$(SUM(Y$(YVALUE(Y) LE YVALUE(IY411)),IAGKNY(Y,IA,G)) AND RRRAAA(IR,IA) AND IGE(G) AND NOT(IGH(G)) AND NOT(IHYDROGEN_GH2STO(G)) AND NOT(IHYDROGEN_GETOHH2(G)) AND NOT(IHYDROGEN_GETOH2(G)) AND NOT(IHYDROGEN_GCH4TOH2(G))),
    VGKNACCUMNET(IY411,IA,G)*ANTBALM_GCAPCRED(IY411, IR,G)/(1$((NOT IGESTO(G)) AND (NOT IGESTOS(G)))+GDATA(G,'GDSTOHUNLD')$((IGESTO(G)) OR IGESTOS(G)))
    )
    +SUM(IRE$IXK_HASORPOT(IY411,IRE,IR), 
      XKFX(IY411,IRE,IR)*ANTBALM_XCAPCRED(IY411,IRE,IR)
      +(VXKNACCUMNET(IY411,IRE,IR)*ANTBALM_XCAPCRED(IY411,IRE,IR))$(XINVESTSTART LE YVALUE(IY411))
    )

   =G=
   
   ANTBALM_RESMAR(IY411, IR) * ANTBALM_MAXDEM(IY411, IR)

;

$ifi not %H2CAPCRED%==yes $goto NoH2CapCred
QANTBALM_H2RESCAP(IY411, IR)$(GINVESTSTART LE YVALUE(IY411))..
    SUM((IA,G)$(IAGK_HASORPOT(IY411,IA,G) AND RRRAAA(IR,IA) AND NOT(IGE(G)) AND NOT(IGH(G)) AND (IHYDROGEN_GH2STO(G) OR IHYDROGEN_GETOHH2(G) OR IHYDROGEN_GETOH2(G) OR IHYDROGEN_GCH4TOH2(G))),
    GKFX(IY411,IA,G)*ANTBALM_GCAPCRED(IY411, IR,G)*(1$IHYDROGEN_GH2STO(G)+GDATA(G,'GDFE')$(NOT(IHYDROGEN_GH2STO(G))))/(1$(NOT IHYDROGEN_GH2STO(G))+GDATA(G,'GDSTOHUNLD')$IHYDROGEN_GH2STO(G))
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM(IY411,IA,G)$IGDECOMEXOPOT(IY411,IA,G)*ANTBALM_GCAPCRED(IY411, IR,G)*(1$IHYDROGEN_GH2STO(G)+GDATA(G,'GDFE')$(NOT(IHYDROGEN_GH2STO(G))))/(1$(NOT IHYDROGEN_GH2STO(G))+GDATA(G,'GDSTOHUNLD')$IHYDROGEN_GH2STO(G))
    )
    +SUM(IAGK_HASORPOT(IY411,IA,G)$(SUM(Y$(YVALUE(Y) LE YVALUE(IY411)),IAGKNY(Y,IA,G)) AND RRRAAA(IR,IA) AND NOT(IGE(G)) AND NOT(IGH(G)) AND (IHYDROGEN_GH2STO(G) OR IHYDROGEN_GETOHH2(G) OR IHYDROGEN_GETOH2(G) OR IHYDROGEN_GCH4TOH2(G))),
    VGKNACCUMNET(IY411,IA,G)*ANTBALM_GCAPCRED(IY411, IR,G)*(1$IHYDROGEN_GH2STO(G)+GDATA(G,'GDFE')$(NOT(IHYDROGEN_GH2STO(G))))/(1$(NOT IHYDROGEN_GH2STO(G))+GDATA(G,'GDSTOHUNLD')$IHYDROGEN_GH2STO(G))
    )
    +SUM(IRE$IXK_HASORPOT(IY411,IRE,IR), 
      XH2KFX(IY411,IRE,IR)*ANTBALM_XCAPCRED(IY411,IRE,IR)
      +(VXH2KNACCUMNET(IY411,IRE,IR)*ANTBALM_XH2CAPCRED(IY411,IRE,IR))$(XH2INVESTSTART LE YVALUE(IY411))
    )

   =G=
   
   ANTBALM_H2RESMAR(IY411, IR) * ANTBALM_H2MAXDEM(IY411, IR)

;

$label NoH2CapCred
$label NoCapCred




$ifi not %MARKETVAL%==yes $goto NoMarketValue
* Correct GDATA, so those without from/last year is set to max range
* GDATA(G, 'GDFROMYEAR')$(NOT GDATA(G, 'GDFROMYEAR')) = 2020;
* GDATA(G, 'GDLASTYEAR')$(NOT GDATA(G, 'GDLASTYEAR')) = 2050;

* * Force very small investment in all thermal and storage technologies to make sure that profit signals are used
* VGKNACCUMNET.LO(Y,IA,G)$(
*     GINVESTSTART LE YVALUE(Y) AND
*     YVALUE(Y) GE GDATA(G, 'GDFROMYEAR') AND
*     YVALUE(Y) LE GDATA(G, 'GDLASTYEAR') AND
*     IAGK_HASORPOT(Y,IA,G) AND (
*     (GDATA(G,'GDTECHGROUP') EQ STEAMTURBINE_SUBCRITICAL)        OR
*     (GDATA(G,'GDTECHGROUP') EQ STEAMTURBINE_SUPERCRITICAL)      OR
*     (GDATA(G,'GDTECHGROUP') EQ ENGINE_IC)                       OR
*     (GDATA(G,'GDTECHGROUP') EQ COMBINEDCYCLE)                   OR
*     (GDATA(G,'GDTECHGROUP') EQ ELECTRICITY_BATTERY)             OR
*     (GDATA(G,'GDTECHGROUP') EQ GASTURBINE)                      OR
*     (GDATA(G,'GDTECHGROUP') EQ FUELCELL)                        OR
*     (GDATA(G,'GDTECHGROUP') EQ STEAMREFORMING)                  OR
*     (GDATA(G,'GDTECHGROUP') EQ H2_STORAGE)                     
*     )
*     ) = 1;
$label NoMarketValue